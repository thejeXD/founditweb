<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Submit Item | Found IT</title>
    
    <link rel="stylesheet" href="/FoundIT/styles/normalize.css" />
    <link rel="stylesheet" href="/FoundIT/styles/pages/dashboard.css" />
    <link rel="stylesheet" href="/FoundIT/styles/pages/submit-item.css" />
    <link rel="stylesheet" href="/FoundIT/styles/components/sidebar.css" />
    <link rel="stylesheet" href="/FoundIT/styles/components/notification.css" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"/>
    <style>
      .type-btn.active {
        background: #2176c7 !important;
        color: #fff !important;
        border: 2px solid #2176c7 !important;
        box-shadow: 0 2px 8px rgba(33,118,199,0.08);
      }
      .type-btn {
        background: #fff !important;
        color: #2176c7 !important;
        border: 2px solid #4a90e2 !important;
        font-weight: bold !important;
        border-radius: 8px 8px 0 0 !important;
        padding: 0.5em 1.2em !important;
        box-shadow: none !important;
        transition: background 0.15s, color 0.15s, border 0.15s;
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <a href="/FoundIT/pages/dashboard.html">
            <img src="/FoundIT/assets/logo.png" alt="FoundIT Logo" class="sidebar-logo" />
          </a>
        </div>
        
        <nav class="sidebar-nav">
          <ul class="nav-list">
            <li class="nav-section-title">INFORMATION</li>
            <li class="nav-item">
              <a href="/FoundIT/pages/dashboard.html" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                  <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                Dashboard
              </a>
            </li>
            <li class="nav-item">
              <a href="/FoundIT/pages/submit-item.html" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12h14"></path>
                </svg>
                Submit Item
              </a>
            </li>
            <li class="nav-item">
              <a href="/FoundIT/pages/my-items.html" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 8v13H3V8M1 3h22v5H1z"></path>
                  <path d="M10 12h4"></path>
                </svg>
                My Items
              </a>
            </li>
            <li class="nav-item">
              <a href="/FoundIT/pages/inbox.html" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 12h-6l-2 3h-4l-2-3H2"></path>
                  <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path>
                </svg>
                Inbox
              </a>
            </li>
            <li class="nav-item">
              <a href="/FoundIT/pages/settings.html" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
                Settings
              </a>
            </li>
            <li class="nav-item">
              <a href="/FoundIT/pages/lost-found.html" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                Lost & Found
              </a>
            </li>
            <li class="nav-item admin-only" style="display:none;">
              <a href="/FoundIT/pages_admin/dashboard.html" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <path d="M16 3v4a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V3"></path>
                </svg>
                Administration
              </a>
            </li>
            <li class="nav-section-title">OTHERS</li>
            <li class="nav-item">
              <a href="/FoundIT/public/about.html#mission" class="nav-link" target="_blank">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="4" y="4" width="16" height="16" rx="2"/>
                  <line x1="8" y1="8" x2="16" y2="8"/>
                  <line x1="8" y1="12" x2="16" y2="12"/>
                  <line x1="8" y1="16" x2="12" y2="16"/>
                </svg>
                Mission & Vision
              </a>
            </li>
            <li class="nav-item">
              <a href="/FoundIT/public/about.html" class="nav-link" target="_blank">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M12 16v-4"></path>
                  <path d="M12 8h.01"></path>
                </svg>
                About
              </a>
            </li>
            <li class="nav-item">
              <a href="/FoundIT/public/faq.html" class="nav-link">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M12 16v-4"></path>
                  <path d="M12 8h.01"></path>
                </svg>
                FAQs
              </a>
            </li>
            
          </ul>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Top Bar -->
        <header class="top-bar">
          <h1 class="page-title">Submit Item</h1>
          <div class="user-menu">
            <div class="notifications">
              <button class="notification-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                  <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                <span class="notification-dot"></span>
              </button>
            </div>
            <div class="user-profile">
              <span class="user-name">John Doe</span>
            </div>
          </div>
        </header>

        <!-- Submit Item Form -->
        <div class="submit-form-container">
          <div class="form-type-selector">
            <button class="type-btn active" data-type="lost">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
              Lost Item
            </button>
            <button class="type-btn" data-type="found">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
              </svg>
              Found Item
            </button>
          </div>

          <form class="submit-form">
            <div class="form-section">
              <h2>Item Details</h2>
              
              <div class="form-group">
                <label for="item-name">Item Name<span style="color:#dc3545">*</span></label>
                <input type="text" id="item-name" name="item-name" required placeholder="e.g., Blue Wallet, Student ID" />
                <div class="error-message" id="error-item-name"></div>
              </div>

              <div class="form-group">
                <label for="category">Category<span style="color:#dc3545">*</span></label>
                <select id="category" name="category" required>
                  <option value="">Select a category</option>
                  <option value="electronics">Electronics</option>
                  <option value="electronics">Personal Belongings</option>
                  <option value="electronics">Student Essentials</option>
                  <option value="electronics">Cards</option>
                  <option value="accessories">Accessories</option>
                  <option value="documents">Documents</option>
                  <option value="clothing">Clothing</option>
                  <option value="electronics">Miscellaneous</option>
                  <option value="other">Other</option>
                </select>
                <div class="error-message" id="error-category"></div>
              </div>

              <div class="form-group">
                <label for="description">Description<span style="color:#dc3545">*</span></label>
                <textarea id="description" name="description" rows="4" required placeholder="Provide detailed description of the item..."></textarea>
                <div class="error-message" id="error-description"></div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="date">Date<span style="color:#dc3545">*</span></label>
                  <input type="date" id="date" name="date" required />
                  <div class="error-message" id="error-date"></div>
                </div>

                <div class="form-group">
                  <label for="time">Time (Approximate)</label>
                  <input type="time" id="time" name="time" />
                </div>
              </div>
            </div>

            <div class="form-section">
              <h2>Location Details</h2>
              
              <div class="form-group">
                <label for="location">Location<span style="color:#dc3545">*</span></label>
                <select id="location" name="location" required>
                  <option value="">Select location</option>
                  <option value="building-a">Building A</option>
                  <option value="building-b">Building C</option>
                  <option value="building-b">Building D</option>
                  <option value="library">Library</option>
                  <option value="cafeteria">Cafeteria</option>
                  <option value="gym">Court</option>
                  <option value="other">Other</option>
                </select>
                <div class="error-message" id="error-location"></div>
              </div>

              <div class="form-group">
                <label for="specific-location">Specific Location</label>
                <input type="text" id="specific-location" name="specific-location" placeholder="e.g., 2nd Floor, Room 201" />
              </div>
            </div>

            <div class="form-section">
              <h2>Additional Information</h2>
              
              <div class="form-group">
                <label for="images">Upload Images</label>
                <div class="file-upload">
                  <input type="file" id="images" name="images" accept="image/*" />
                  <div class="upload-placeholder">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="17 8 12 3 7 8"></polyline>
                      <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <span>Drop images here or click to upload</span>
                  </div>
                </div>
                <div class="error-message" id="error-images"></div>
              </div>

              <div class="image-preview-list" id="image-preview-list"></div>

              <div class="form-group">
                <label for="contact-preference">Contact Method<span style="color:#dc3545">*</span></label>
                <select id="contact-preference" name="contact-preference" required>
                  <option value="">Select contact method</option>
                  <option value="email">Email</option>
                </select>
                <div class="error-message" id="error-contact-preference"></div>
              </div>

              <div class="form-group" id="left-with-group" style="display:none;">
                <label for="left-with">Where did you leave the item?</label>
                <input type="text" id="left-with" name="left-with" placeholder="e.g., Guard, Front Desk, Lost & Found Office" />
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary">Cancel</button>
              <button type="submit" class="btn btn-primary">Submit Item</button>
            </div>
          </form>
        </div>
      </main>
    </div>

    <footer style="background:#f7f8fa;border-top:1px solid #eee;padding:24px 0;text-align:center;color:#888;font-size:0.95rem;margin-top:auto;">
      &copy; <span id="footer-year"></span> Found IT. All rights reserved.
    </footer>
    <script>document.getElementById('footer-year').textContent = new Date().getFullYear();</script>

    <script>
      document.addEventListener('DOMContentLoaded', async function() {
        const badge = document.getElementById('sidebar-inbox-dot');
        if (badge) {
          try {
            const res = await fetch('/FoundIT/api/inbox.php');
            const data = await res.json();
            let unreadCount = 0;
            if (data.success) {
              data.messages.forEach(msg => { if (msg.is_read == 0) unreadCount++; });
            }
            if (unreadCount > 0) {
              badge.textContent = unreadCount;
              badge.style.display = 'inline-block';
              badge.style.background = '#dc3545';
              badge.style.color = '#fff';
              badge.style.borderRadius = '50%';
              badge.style.padding = '0.18em 0.7em';
              badge.style.fontWeight = '700';
              badge.style.fontSize = '0.98em';
              badge.style.marginLeft = '0.4em';
              badge.style.minWidth = '1.7em';
              badge.style.textAlign = 'center';
              badge.style.lineHeight = '1.2em';
              console.log(unreadCount);
            } else {
              badge.textContent = '';
              badge.style.display = 'none';
              console.log("No unread messages");
            }
          } catch {
            badge.textContent = '';
            badge.style.display = 'none';
          }
        }
        // User dropdown and notification click logic
        const userName = document.querySelector('.user-name');
        let userDropdown = document.querySelector('.user-dropdown');
        if (!userDropdown && userName) {
          userDropdown = document.createElement('div');
          userDropdown.className = 'user-dropdown hidden';
          userDropdown.innerHTML = '<button id="logout-btn" style="background:#dc3545;color:#fff;padding:8px 16px;border:none;border-radius:4px;cursor:pointer;margin-top:8px;">Logout</button>';
          userName.parentNode.appendChild(userDropdown);
        }
        if (userName) {
          userName.onclick = function() {
            userDropdown.classList.toggle('hidden');
          };
        }
        document.addEventListener('click', function(e) {
          if (userDropdown && !userDropdown.contains(e.target) && !userName.contains(e.target)) {
            userDropdown.classList.add('hidden');
          }
        });
        if (userDropdown) {
          userDropdown.querySelector('#logout-btn').onclick = async function() {
            await fetch('/FoundIT/api/logout.php');
            window.location.href = '/FoundIT/auth/login.html';
          };
        }
        // Notification icon click
        const notifBtn = document.querySelector('.notification-btn');
        if (notifBtn) {
          notifBtn.onclick = function() {
            window.location.href = '/FoundIT/pages/inbox.html';
          };
        }
      });
      </script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const typeBtns = document.querySelectorAll('.type-btn');
        const leftWithGroup = document.getElementById('left-with-group');
        typeBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            typeBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            // Show/hide left-with field
            if (btn.dataset.type === 'found') {
              leftWithGroup.style.display = '';
            } else {
              leftWithGroup.style.display = 'none';
              document.getElementById('left-with').value = '';
            }
          });
        });
      });
    </script>

    <script>
      // --- Custom Notification Helper ---
      function showNotification(type, title, message) {
        // Assumes you have a .custom-notification element in your layout
        let notif = document.querySelector('.custom-notification');
        if (!notif) {
          notif = document.createElement('div');
          notif.className = 'custom-notification ' + type;
          notif.innerHTML = `
            <span class="notification-icon">&#9888;</span>
            <div class="notification-content">
              <div class="notification-title">${title}</div>
              <div class="notification-message">${message}</div>
            </div>
          `;
          document.body.appendChild(notif);
        } else {
          notif.className = 'custom-notification ' + type;
          notif.querySelector('.notification-title').textContent = title;
          notif.querySelector('.notification-message').textContent = message;
        }
        notif.classList.add('show');
        setTimeout(() => notif.classList.remove('show'), 4000);
      }

      // --- Bad Words List ---
      const BAD_WORDS = [
        'fuck', 'shit', 'bitch', 'asshole', 'bastard', 'damn', 'crap', 'dick', 'piss', 'cunt', 'fag', 'slut', 'whore', 'nigger', 'fucker', 'motherfucker', 'cock', 'pussy', 'ass', 'retard', 'douche', 'bollocks', 'bugger', 'bloody', 'arse', 'wank', 'twat', 'prick', 'tit', 'tosser', 'wanker', 'jerk', 'idiot', 'moron', 'stupid'
      ];
      function containsBadWords(str) {
        const lower = str.toLowerCase();
        return BAD_WORDS.some(word => lower.includes(word));
      }

      // --- Validation ---
      document.querySelector('.submit-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        let valid = true;

        // Helper to set error
        function setError(id, msg) {
          const el = document.getElementById('error-' + id);
          if (el) el.textContent = msg;
          const input = document.getElementById(id);
          if (input) input.style.borderColor = '#dc3545';
          valid = false;
        }
        function clearError(id) {
          const el = document.getElementById('error-' + id);
          if (el) el.textContent = '';
          const input = document.getElementById(id);
          if (input) input.style.borderColor = '';
        }

        // Validate required fields
        const requiredFields = [
          'item-name', 'category', 'description', 'date', 'location', 'contact-preference'
        ];
        requiredFields.forEach(id => {
          const val = document.getElementById(id).value.trim();
          clearError(id);
          if (!val) setError(id, 'This field is required.');
        });

        // Regex validation (no script tags, no SQL, no special chars in name/desc)
        const name = document.getElementById('item-name').value.trim();
        const desc = document.getElementById('description').value.trim();
        const regex = /^[a-zA-Z0-9\s.,'"()\-!?:;]+$/;
        if (name && !regex.test(name)) setError('item-name', 'Invalid characters.');
        if (desc && !regex.test(desc)) setError('description', 'Invalid characters.');

        // Word censorship
        if (containsBadWords(name)) setError('item-name', 'Inappropriate language detected.');
        if (containsBadWords(desc)) setError('description', 'Inappropriate language detected.');

        // Image validation
        const images = document.getElementById('images');
        clearError('images');
        if (images && images.files.length > 0) {
          if (images.files.length > 1) {
            setError('images', 'You can upload only 1 image.');
          }
          for (let i = 0; i < images.files.length; i++) {
            const file = images.files[i];
            if (!file.type.startsWith('image/')) {
              setError('images', 'Only image files are allowed.');
              break;
            }
            if (file.size > 5 * 1024 * 1024) {
              setError('images', 'Image must be less than 5MB.');
              break;
            }
          }
        }

        // If not valid, show notification and stop
        if (!valid) {
          showNotification('error', 'Form Error', 'Please fix the errors in the form.');
          return;
        }

        // Prepare form data for AJAX
        const form = e.target;
        const formData = new FormData(form);
        // Add item type (lost/found)
        const type = document.querySelector('.type-btn.active').dataset.type;
        formData.append('type', type);
        // Add left-with if present
        const leftWith = document.getElementById('left-with').value.trim();
        if (leftWith) formData.append('left-with', leftWith);

        // Submit via AJAX
        try {
          const res = await fetch('/FoundIT/api/submit-item.php', {
            method: 'POST',
            body: formData
          });
          const data = await res.json();
          if (data.success) {
            showNotification('success', 'Success', data.message || 'Item submitted successfully!');
            form.reset();
            // Optionally redirect or update UI
          } else {
            showNotification('error', 'Submission Failed', data.message || 'There was an error submitting your item.');
          }
        } catch (err) {
          showNotification('error', 'Network Error', 'Could not submit item. Please try again.');
          console.log("Network Error: " + err);
        }
      });

      // Image preview logic
      const imagesInput = document.getElementById('images');
      const previewList = document.getElementById('image-preview-list');
      if (imagesInput && previewList) {
        imagesInput.addEventListener('change', function() {
          previewList.innerHTML = '';
          if (imagesInput.files && imagesInput.files.length > 0) {
            const file = imagesInput.files[0];
            if (file.type.startsWith('image/')) {
              const reader = new FileReader();
              reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                // Add remove button
                const removeBtn = document.createElement('button');
                removeBtn.textContent = 'Remove';
                removeBtn.type = 'button';
                removeBtn.className = 'remove-image-btn';
                removeBtn.onclick = function() {
                  imagesInput.value = '';
                  previewList.innerHTML = '';
                };
                const wrapper = document.createElement('div');
                wrapper.appendChild(img);
                wrapper.appendChild(removeBtn);
                previewList.appendChild(wrapper);
              };
              reader.readAsDataURL(file);
            }
          }
        });
      }

      // Cancel button logic
      const cancelBtn = document.querySelector('.btn.btn-secondary');
      const form = document.querySelector('.submit-form');
      if (cancelBtn && form) {
        cancelBtn.addEventListener('click', function() {
          form.reset();
          if (previewList) previewList.innerHTML = '';
          // Optionally clear all error messages and borders
          document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
          document.querySelectorAll('input, select, textarea').forEach(el => el.style.borderColor = '');
        });
      }
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', async function() {
        try {
          const res = await fetch('/FoundIT/api/settings.php');
          const data = await res.json();
          if (!data.success) {
            window.location.href = '/FoundIT/auth/login.html';
            return;
          }
          // Set full name in user profile (top bar)
          document.querySelectorAll('.user-name').forEach(el => {
            el.textContent = data.profile.first_name + ' ' + data.profile.last_name;
          });
        } catch (e) {
          window.location.href = '/FoundIT/auth/login.html';
        }
      });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', async function() {
        let role = null;
        try {
          const res = await fetch('/FoundIT/api/settings.php');
          const data = await res.json();
          if (data.success) {
            role = Number(data.profile.role);
          }
        } catch {}
        if (role === 2 || role === 3) {
          document.querySelectorAll('.admin-only').forEach(el => el.style.display = '');
        }
      });
    </script>
  </body>
</html> 