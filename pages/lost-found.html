<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lost and Found Items | FoundIT</title>
  <!-- <link rel="stylesheet" href="/FoundIT/styles/pages/lost-found.css" /> -->
  <link rel="stylesheet" href="/FoundIT/styles/components/header.css" />
  <link rel="stylesheet" href="/FoundIT/styles/components/footer.css" />
  <link rel="stylesheet" href="/FoundIT/styles/normalize.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/FoundIT/styles/components/sidebar.css" />
  <style>
    body, h1, h2, h3, h4, h5, h6, p, a, input, button, label, th, td, select, option {
      font-family: 'Roboto', Arial, Helvetica, sans-serif !important;
    }
    body {
      background-color: #f7f7f7;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .lost-found-container {
      max-width: 1200px;
      margin: 2.5rem auto 2rem auto;
      padding: 2.5rem 2rem 2rem 2rem;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    }
    .lost-found-container h1 {
      font-size: 2.2rem;
      font-weight: 800;
      color: #222;
      margin-bottom: 0.5rem;
    }
    .lost-found-container .subheading {
      font-size: 1.13rem;
      color: #444;
      margin-bottom: 0.7rem;
    }
    .notice {
      color: #388e3c;
      font-size: 1rem;
      margin-bottom: 1.5rem;
    }
    .lost-found-table-wrapper {
      overflow-x: auto;
      margin-top: 1.5rem;
      background: #f9fbfd;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 1.5rem 1rem 2.5rem 1rem;
      max-width: 100%;
    }
    .lost-found-table {
      width: 100%;
      min-width: 700px;
      border-collapse: separate;
      border-spacing: 0;
      font-size: 1.08rem;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 1px 4px rgba(0,0,0,0.03);
    }
    .lost-found-table th {
      background: #fff;
      color: #1db954;
      font-weight: 700;
      padding: 1rem 1.2rem;
      text-align: left;
      border-bottom: 2px solid #e3f2fd;
      font-size: 1.08rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }
    .lost-found-table td {
      padding: 0.85rem 1.2rem;
      border-bottom: 1px solid #f0f0f0;
      color: #222;
      font-size: 1.05rem;
      background: #fff;
    }
    .lost-found-table tr:nth-child(even) td {
      background: #f6fafd;
    }
    .lost-found-table tr.item-link {
      cursor: pointer;
      transition: background 0.15s;
    }
    .lost-found-table tr.item-link:hover td {
      background: #e3f2fd;
    }
    .lost-found-table th:first-child, .lost-found-table td:first-child {
      border-top-left-radius: 10px;
    }
    .lost-found-table th:last-child, .lost-found-table td:last-child {
      border-top-right-radius: 10px;
    }
    @media (max-width: 900px) {
      .lost-found-container {
        padding: 1.2rem 0.5rem;
      }
    }
    @media (max-width: 700px) {
      .lost-found-container {
        padding: 0.7rem 0.2rem;
      }
      .lost-found-table-wrapper {
        padding: 0.5rem 0.1rem;
      }
      .lost-found-table th, .lost-found-table td {
        padding: 0.5rem 0.5rem;
        font-size: 0.97rem;
      }
    }
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
      margin: 2.5rem 0 0 0;
      font-size: 1.08rem;
      user-select: none;
    }
    .pagination-btn {
      background: #fff;
      border: 1px solid #1db954;
      color: #1db954;
      border-radius: 6px;
      padding: 0.35rem 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }
    .pagination-btn.active, .pagination-btn:hover {
      background: #1db954;
      color: #fff;
    }
    .sidebar .nav-section-title {
      font-weight: bold;
      color: var(--clr-primary) !important;
      letter-spacing: 0.02em;
      margin-top: 1.2em;
      margin-bottom: 0.7em;
      font-size: 1.08em;
    }
    .sidebar .nav-link {
      color: #222 !important;
      font-weight: 500;
      font-size: 1.07em;
      display: flex;
      align-items: center;
      gap: 0.7em;
      padding: 0.55em 0.7em;
      border-radius: 8px;
      transition: background 0.13s, color 0.13s;
    }
    .sidebar .nav-link:hover, .sidebar .nav-link:focus {
      background: #eaf4fd;
      color: var(--clr-primary) !important;
      text-decoration: none;
    }
    .sidebar .nav-item {
      margin-bottom: 0.2em;
    }
    .sidebar .nav-icon {
      min-width: 20px;
      min-height: 20px;
      color: var(--clr-primary);
      opacity: 0.95;
    }
  </style>
</head>
<body>
  <header class="header">
    <nav class="header-nav">
      <a href="/FoundIT/" class="logo-link">
        <img src="/FoundIT/assets/logo.png" alt="Found IT Logo" class="logo" />
      </a>
      <ul class="header-nav-links">
        <li><a href="/FoundIT/" class="header-nav-link">Home</a></li>
        <li><a href="/FoundIT/public/about.html" class="header-nav-link">About</a></li>
        <li><a href="/FoundIT/public/contact.html" class="header-nav-link">Contact</a></li>
        <li class="login-link"><a href="/FoundIT/auth/login.html" class="header-nav-link">Login</a></li>
        <li class="signup-link"><a href="/FoundIT/auth/sign-up.html" class="sign-up-btn">Sign Up <img src="/FoundIT/assets/icons_svg/user.svg" alt="User Icon" class="icon" /></a></li>
        <li class="dashboard-link" style="display:none;"><a href="#" class="header-nav-link" id="dashboard-btn">Dashboard</a></li>
        <li class="logout-link" style="display:none;"><a href="#" class="header-nav-link" id="logout-btn">Logout</a></li>
      </ul>
      <button class="hamburger-menu">
        <img src="/FoundIT/assets/hamburger-menu-svgrepo-com.svg" alt="Menu" class="hamburger-icon" />
      </button>
    </nav>
  </header>
  <main class="lost-found-container">
    <h1>Daily Lost and Found Monitoring</h1>
    <div class="subheading">Below is the daily updated list of lost and found items reported across the campus. This list is for reference only. To view item details or claim an item, you must have an account.</div>
    <div class="notice" style="color:var(--clr-primary);">Notice: Items are listed here for 2 months from the date found. For further assistance, please contact the campus Lost & Found office.</div>
    <div style="display:flex;gap:1.5rem;align-items:center;margin-bottom:1.5rem;">
      <select id="filter-location" style="padding:0.5rem 1rem;border-radius:8px;border:1px solid #d9d9d9;font-size:1rem;"></select>
      <input type="date" id="filter-date" style="padding:0.5rem 1rem;border-radius:8px;border:1px solid #d9d9d9;font-size:1rem;" />
      <select id="filter-status" style="padding:0.5rem 1rem;border-radius:8px;border:1px solid #d9d9d9;font-size:1rem;">
        <option value="">All Status</option>
        <option value="1">ACTIVE</option>
        <option value="0">ARCHIVED</option>
      </select>
    </div>
    <div class="lost-found-table-wrapper">
      <table class="lost-found-table" id="lost-found-table">
        <thead>
          <tr>
            <th>Reference No.</th>
            <th>Location</th>
            <th>Name / Description</th>
            <th>Date Found/Lost</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <!-- Items will be injected by JS -->
        </tbody>
      </table>
    </div>
    <div class="pagination" id="pagination"></div>
  </main>
  <footer style="background:#f7f8fa;border-top:1px solid #eee;padding:24px 0;text-align:center;color:#888;font-size:0.95rem;margin-top:auto;">
    &copy; <span id="footer-year"></span> Found IT. All rights reserved.
  </footer>
  <script>
    // --- PRIMARY COLOR ---
    document.documentElement.style.setProperty('--clr-success', 'var(--clr-primary)');
    document.documentElement.style.setProperty('--clr-success-light', 'var(--clr-primary)');
    // --- PAGINATION + FETCH LOGIC ---
    const ITEMS_PER_PAGE = 15;
    let allItems = [];
    let filteredItems = [];
    let currentPage = 1;
    let isLoggedIn = false;
    let allLocations = [];
    async function checkLogin() {
      try {
        const res = await fetch('/FoundIT/api/settings.php');
        const data = await res.json();
        isLoggedIn = !!data.success;
      } catch { isLoggedIn = false; }
    }
    function applyFilters() {
      const loc = document.getElementById('filter-location').value;
      const date = document.getElementById('filter-date').value;
      const status = document.getElementById('filter-status').value;
      filteredItems = allItems.filter(item => {
        let ok = true;
        if (loc && (item.location + (item.specific_location ? ' - ' + item.specific_location : '')) !== loc) ok = false;
        if (date && item.date_time && item.date_time.substring(0,10) !== date) ok = false;
        if (status && String(item.status) !== status) ok = false;
        return ok;
      });
      currentPage = 1;
      renderTable();
      renderPagination();
    }
    function renderTable() {
      const tbody = document.querySelector('#lost-found-table tbody');
      tbody.innerHTML = '';
      const start = (currentPage - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageItems = filteredItems.slice(start, end);
      for (const item of pageItems) {
        const tr = document.createElement('tr');
        tr.classList.add('item-link');
        if (item.status == 1) {
          tr.style.cursor = 'pointer';
        } else {
          tr.style.cursor = 'not-allowed';
          tr.style.opacity = '0.6';
        }
        tr.innerHTML = `
          <td>${item.id}</td>
          <td>${item.location}${item.specific_location ? ' - ' + item.specific_location : ''}</td>
          <td><b>${item.name}</b><br><span style="color:#888;font-size:0.95em;">${item.description}</span></td>
          <td>${item.date_time ? new Date(item.date_time).toLocaleDateString() : ''}</td>
          <td>${item.status == 1 ? '<span style="color:var(--clr-primary);font-weight:600;">ACTIVE</span>' : '<span style="color:#888;">ARCHIVED</span>'}</td>
        `;
        if (item.status == 1) {
          tr.onclick = async function() {
            await checkLogin();
            if (!isLoggedIn) {
              window.location.href = '/FoundIT/auth/sign-up.html';
            } else {
              window.location.href = `/FoundIT/pages/view-item.html?id=${item.id}`;
            }
          };
        }
        tbody.appendChild(tr);
      }
      if (pageItems.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#888;">No items found.</td></tr>';
      }
    }
    function renderPagination() {
      const pag = document.getElementById('pagination');
      pag.innerHTML = '';
      const totalPages = Math.ceil(filteredItems.length / ITEMS_PER_PAGE);
      if (totalPages <= 1) return;
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.className = 'pagination-btn' + (i === currentPage ? ' active' : '');
        btn.textContent = i;
        btn.onclick = function() {
          currentPage = i;
          renderTable();
          renderPagination();
        };
        pag.appendChild(btn);
      }
    }
    async function fetchItems() {
      const res = await fetch('/FoundIT/api/lost-found.php');
      const data = await res.json();
      if (data.success) {
        allItems = data.items;
        // Populate locations
        allLocations = Array.from(new Set(allItems.map(i => i.location + (i.specific_location ? ' - ' + i.specific_location : ''))));
        const locSel = document.getElementById('filter-location');
        locSel.innerHTML = '<option value="">All Locations</option>' + allLocations.map(l => `<option value="${l}">${l}</option>`).join('');
        filteredItems = allItems.slice();
        renderTable();
        renderPagination();
      }
    }
    document.getElementById('filter-location').onchange = applyFilters;
    document.getElementById('filter-date').onchange = applyFilters;
    document.getElementById('filter-status').onchange = applyFilters;
    document.addEventListener('DOMContentLoaded', async function() {
      await checkLogin();
      await fetchItems();
      // Show/hide login/signup/logout links based on session
      try {
        const res = await fetch('/FoundIT/api/settings.php');
        const data = await res.json();
        if (data.success) {
          document.querySelector('.login-link').style.display = 'none';
          document.querySelector('.signup-link').style.display = 'none';
          document.querySelector('.dashboard-link').style.display = '';
          document.querySelector('.logout-link').style.display = '';
          document.getElementById('logout-btn').onclick = async function() {
            await fetch('/FoundIT/api/logout.php');
            window.location.href = '/FoundIT/auth/login.html';
          };
        } else {
          document.querySelector('.login-link').style.display = '';
          document.querySelector('.signup-link').style.display = '';
          document.querySelector('.logout-link').style.display = 'none';
        }
      } catch {
        document.querySelector('.login-link').style.display = '';
        document.querySelector('.signup-link').style.display = '';
        document.querySelector('.logout-link').style.display = 'none';
      }
    });
    document.getElementById('footer-year').textContent = new Date().getFullYear();
  </script>
</body>
</html> 